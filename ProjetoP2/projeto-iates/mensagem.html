<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Luxo - Mensagens Recebidas</title>
    <link rel="shortcut icon" href="images/barco2.png" type="image/x-icon" />
    <link rel="stylesheet" href="css/default.css" />
  </head>

  <body>
    <div class="page">
    <header>
      <div id="title">
        <img src="images/barco1.png" alt="ícone de barco" />
        <div class="headtitle">
          <h1>Luxo</h1>
          <h2>Aluguel de iates</h2>
        </div>
      </div>

      <nav>
        <ul class="navmenu">
       <li><a href="index.html">Página inicial</a></li>
       <li><a href="aluguel.html">Aluguel de iates</a></li>
       <li><a href="destinos.html">Destinos</a></li>
       <li><a href="tripulacao.html">Tripulação</a></li>
       <li><a href="contato.html">Contato</a></li>
       <li><a href="admin.html" class="accent">Admin</a></li>
       <li><a href="index.html">Sair</a></li>
        </ul>
      </nav>
    </header>

    <main>
      <div class="pagtitle">
        <div class="bgtitle"></div>
        <h2>Mensagens Recebidas</h2>
      </div>

      <section class="mensagens-container">
        <table id="tabelaMensagens">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>E-mail</th>
                    <th>Mensagem</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
        <div id="loading">Carregando mensagens...</div>
        <div id="no-msg" style="display:none; text-align:center; padding:20px;">Nenhuma mensagem encontrada.</div>
      </section>
    </main>
    </div>

    <footer>
      <p>© 2023 por Luxo aluguel de iates</p>
    </footer>

  
    <script src="js/jquery-3.6.4.min.js"></script>
    <script src="js/api.js"></script>

    
    <script>
        $(document).ready(function() {
            carregarMensagens();
        });

        function carregarMensagens() {
           
            var mensagensAPI = obterMensagens(); 

          
            var mensagensLocal = JSON.parse(localStorage.getItem('luxo_mensagens')) || [];

            
            mensagensAPI.forEach(function(msgApi) {
                var existe = false;
                
               
                for(var i=0; i < mensagensLocal.length; i++) {
                    if(mensagensLocal[i].email === msgApi.email && mensagensLocal[i].mensagem === msgApi.mensagem) {
                        existe = true;
                        break;
                    }
                }

             
                if(!existe) {
                
                    var novaMsg = {
                        nome: msgApi.nome,
                        email: msgApi.email,
                        mensagem: msgApi.mensagem,
                        visualizada: false 
                    };
                    mensagensLocal.push(novaMsg);
                }
            });


            atualizarLocalStorage(mensagensLocal);

            renderizarTabela(mensagensLocal);
        }

        function renderizarTabela(listaMensagens) {
            var tbody = $('#tabelaMensagens tbody');
            tbody.empty();
            $('#loading').hide();

            if(listaMensagens.length === 0) {
                $('#no-msg').show();
                return;
            }

            listaMensagens.forEach(function(msg, index) {
               
                var classeVisual = msg.visualizada ? 'msg-normal' : 'msg-negrito';
                
                var tr = `
                    <tr class="${classeVisual}">
                        <td>${msg.nome}</td>
                        <td>${msg.email}</td>
                        <td>${msg.mensagem}</td>
                        <td class="acoes">
                            <button class="btn-visualizar" onclick="marcarComoVisualizada(${index})">Visualizada</button>
                            <button class="btn-excluir" onclick="excluirMensagem(${index})">Excluir</button>
                        </td>
                    </tr>
                `;
                tbody.append(tr);
            });
        }

     
        function excluirMensagem(index) {
            if(confirm("Tem certeza que deseja excluir esta mensagem?")) {
                var mensagensLocal = JSON.parse(localStorage.getItem('luxo_mensagens')) || [];
                
              
                mensagensLocal.splice(index, 1);
                
                atualizarLocalStorage(mensagensLocal);
                renderizarTabela(mensagensLocal);
            }
        }

   
        function marcarComoVisualizada(index) {
            if(confirm("Marcar mensagem como visualizada?")) {
                var mensagensLocal = JSON.parse(localStorage.getItem('luxo_mensagens')) || [];
                
           
                mensagensLocal[index].visualizada = true;
                
                atualizarLocalStorage(mensagensLocal);
                renderizarTabela(mensagensLocal);
            }
        }

        function atualizarLocalStorage(dados) {
            localStorage.setItem('luxo_mensagens', JSON.stringify(dados));
        }
    </script>

    <style>
        .mensagens-container {
            padding: 20px;
            margin: 0 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
            text-align: left;
        }

        th {
            background-color: var(--darkblue);
            color: white;
        }

       
        .msg-negrito {
            font-weight: bold;
            background-color: #f9f9f9;
        }

        
        .msg-normal {
            font-weight: normal;
            color: #555;
        }

        .acoes {
            display: flex;
            gap: 5px;
        }

        button {
            padding: 5px 10px;
            cursor: pointer;
            border: none;
            color: white;
            font-size: 0.9em;
        }

        .btn-visualizar {
            background-color: var(--lightblue);
        }

        .btn-excluir {
            background-color: #e74c3c;
        }

        button:hover {
            opacity: 0.8;
        }
    </style>
  </body>
</html>
